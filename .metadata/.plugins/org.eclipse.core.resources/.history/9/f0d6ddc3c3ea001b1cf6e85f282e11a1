package WebScraper;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;

public class WikipediaScraper {
	private WebDriver webDriver;
	String sorgente;
	
	public WikipediaScraper(String browser) throws BrowserErratoException {
		if (browser.toLowerCase().equals("chrome")) {
			buildChrome();
		} else if (browser.toLowerCase().equals("firefox")) {
			buildFireFox();
		} else {
		throw new BrowserErratoException("Hai scelto un browser non supportato.");
		}
	}
	
	/**
	 * Utilizza Chrome come browser di navigazione.
	 */
	private void buildChrome() {
		System.setProperty("webdriver.chrome.driver",  "res/chromedriver.exe");
		webDriver = new ChromeDriver();
	}
	
	/**
	 * Utilizza Firefox come browser di navigazione.
	 */
	private void buildFireFox() {
		// TODO
	}
	
	/**
	 * Apre l'url di Wikipedia fornito in input. L'url deve cominciare con https://it.wikipedia.org/wiki/
	 * per essere considerato un url valido.
	 * @param url di Wikipedia da aprire.
	 */
	public void openUrl(String url) {
		if (url.startsWith("https://it.wikipedia.org/wiki/")) {
			webDriver.get(url);
		} else {
			// TODO lanciare un errore
			webDriver.get("https://en.wikipedia.org/wiki/Failure");
		}
	}
	
	/**
	 * Preleva il sorgente Html della pagina aperta nel browser.
	 * @return Il sorgente della pagina.
	 */
	public void pageHtml() {
		this.sorgente = webDriver.getPageSource();
	}
	
	/**
	 * Analizza il codice Html di Wikipedia fornito in input e ritorna un oggetto di tipo Sinottico
	 * contenenti le informazioni riguardo la pagina sorgente fornita come input.
	 * @param sorgente della pagina di Wikipedia
	 * @return L'oggetto Sinottico.
	 */
	public PaginaWikipedia estraiSinottico() {
		return new PaginaWikipedia(htmlPagina());
	}
	
	public PaginaWikipedia estraiSinottico(String url) {
		openUrl(url);
		return new PaginaWikipedia(htmlPagina());
	}
	
	public String htmlPagina() {
		return webDriver.getPageSource();
	}
	
	public static void main(String[] args) {
		try {
		WikipediaScraper ws = new WikipediaScraper("Chrome");
		ws.openUrl("https://it.wikipedia.org/wiki/Settimio_Severo");
//		ws.openUrl("https://it.wikipedia.org/wiki/Dittatore_(storia_romana)");
//		ws.pageHtml();
		PaginaWikipedia sin = ws.estraiSinottico();
		System.out.println(sin.getSinottico());
		System.out.println(sin.getTitle());
		System.out.println(sin.getUrl());
		System.out.println(sin.getUrlImmagine());
		sin.parsaSinottico();
//		System.out.println(ws.estraiSinottico("https://it.wikipedia.org/wiki/Augusto").getSinottico());
		} catch (BrowserErratoException e) {
			e.printStackTrace();
		}
	}

}
